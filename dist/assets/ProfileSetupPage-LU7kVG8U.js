import{d as p,r as u,u as g,b as h,j as e,U as b,z as r,f as j,g as N,h as v}from"./index-QB03IS3m.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=p("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),P=async s=>{const n=j(N,"users",s),l=await v(n);return l.exists()?l.data():null};function w(){const[s,n]=u.useState(""),[l,c]=u.useState(!1),{user:i,updateProfile:m,setupProfile:f}=g(),d=h(),x=async o=>{if(o.preventDefault(),!i){r.error("ユーザー情報が見つかりません");return}if(!s.trim()){r.error("ニックネームを入力してください");return}if(s.length<2){r.error("ニックネームは2文字以上で入力してください");return}if(s.length>20){r.error("ニックネームは20文字以下で入力してください");return}c(!0);try{console.log("ProfileSetupPage: Starting profile setup for user:",i.id);const t=await P(i.id);console.log("ProfileSetupPage: User document exists:",!!t),t?(console.log("ProfileSetupPage: Updating existing user profile"),await m({nickname:s.trim()}),r.success("プロフィールを更新しました")):(console.log("ProfileSetupPage: Creating new user profile"),await f(s.trim()),r.success("プロフィールを作成しました")),console.log("ProfileSetupPage: Profile setup completed successfully"),d("/")}catch(t){console.error("ProfileSetupPage: Profile setup error:",t);let a="プロフィールの保存に失敗しました";t.code==="permission-denied"?a="権限がありません。ログインし直してください":t.code==="unavailable"?a="サーバーに接続できません。インターネット接続を確認してください":t.code==="deadline-exceeded"?a="リクエストがタイムアウトしました。再試行してください":t.message==="No Firebase user"?a="認証情報が見つかりません。ログインし直してください":t.message==="No user logged in"&&(a="ログイン情報が見つかりません。ログインし直してください"),r.error(a)}finally{c(!1)}};return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(b,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"プロフィール設定"}),e.jsx("p",{className:"text-muted-foreground",children:"ニックネームを設定して掲示板を利用開始してください"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-foreground mb-2",children:"メールアドレス"}),e.jsx("input",{type:"email",id:"email",value:i.email,disabled:!0,className:"input w-full bg-muted"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"nickname",className:"block text-sm font-medium text-foreground mb-2",children:["ニックネーム ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{type:"text",id:"nickname",value:s,onChange:o=>n(o.target.value),placeholder:"ニックネームを入力",className:"input w-full",maxLength:20,required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"2-20文字で入力してください"})]}),e.jsx("button",{type:"submit",disabled:l||!s.trim(),className:"btn btn-primary w-full",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"設定中..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"プロフィールを保存"]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"ログインが必要です"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"プロフィール設定を行うにはログインしてください"}),e.jsx("button",{onClick:()=>d("/login"),className:"btn btn-primary",children:"ログイン画面へ"})]})})}export{w as default};
